<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>İşletme Paneli | Cepterandevu</title>

  <style>
    :root {
      --bg:#050816;
      --card:#0f172a;
      --card-soft:#020617;
      --text:#f8fafc;
      --muted:#94a3b8;
      --accent:#22c55e;
      --accent-strong:#16a34a;
      --danger:#ef4444;
      --border:rgba(148,163,184,0.35);
      --radius-lg:18px;
      --shadow-soft:0 18px 45px rgba(15,23,42,0.85);
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      background:radial-gradient(circle at top,#111827,#020617 55%);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:20px 12px 32px;
    }

    .app{
      width:100%;
      max-width:1040px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:18px;
    }

    .logo{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .logo-mark{
      width:32px;height:32px;
      border-radius:14px;
      background:radial-gradient(circle at 30% 10%,#4ade80,#16a34a 42%,#0f766e);
      display:flex;align-items:center;justify-content:center;
      font-size:18px;font-weight:800;color:#ecfdf5;
      box-shadow:0 10px 30px rgba(34,197,94,0.6);
    }
    .logo-text-main{font-weight:600;font-size:16px;}
    .logo-text-sub{font-size:11px;color:var(--muted);}

    .logout-btn{
      border:0;
      border-radius:999px;
      padding:7px 14px;
      font-size:12px;
      cursor:pointer;
      background:var(--danger);
      color:#fff;
      font-weight:600;
    }

    .main-grid{
      display:grid;
      grid-template-columns:minmax(0,1.25fr) minmax(0,1fr);
      gap:16px;
    }
    @media(max-width:840px){
      .main-grid{
        grid-template-columns:minmax(0,1fr);
      }
    }

    .card{
      background:rgba(15,23,42,0.96);
      border-radius:var(--radius-lg);
      border:1px solid var(--border);
      box-shadow:var(--shadow-soft);
      padding:16px 16px 18px;
      margin-bottom:16px;
    }

    h2{font-size:18px;margin-bottom:8px;}
    .sub{font-size:12px;color:var(--muted);margin-bottom:10px;}

    .biz-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
      margin-bottom:10px;
    }

    .biz-name{
      font-size:18px;
      font-weight:600;
    }
    .biz-location{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    .pill{
      font-size:11px;
      border-radius:999px;
      padding:3px 9px;
      border:1px solid rgba(148,163,184,0.5);
      color:var(--muted);
      background:#020617;
      white-space:nowrap;
    }

    .tag-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:8px;
    }
    .tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.45);
      color:var(--muted);
      background:#020617;
    }

    .biz-stats{
      display:flex;
      gap:12px;
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }
    .biz-stats span strong{
      display:block;
      color:var(--text);
      font-size:14px;
    }

    .nav-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:12px;
      margin-top:4px;
    }
    @media(max-width:560px){
      .nav-grid{
        grid-template-columns:minmax(0,1fr);
      }
    }

    .nav-card{
      background:var(--card-soft);
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.35);
      padding:12px 12px 13px;
      cursor:pointer;
      transition:all 0.16s ease-out;
    }
    .nav-card:hover{
      border-color:var(--accent);
      box-shadow:0 12px 30px rgba(15,23,42,0.9);
      transform:translateY(-1px);
    }

    .nav-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:4px;
    }
    .nav-desc{
      font-size:11px;
      color:var(--muted);
    }

    .stat-box{
      display:flex;
      justify-content:space-between;
      margin-top:8px;
      font-size:11px;
      color:var(--muted);
    }

    .small-label{
      font-size:11px;
      color:var(--muted);
    }

    .hint{
      font-size:11px;
      color:var(--muted);
      margin-top:4px;
    }

    .error-box{
      background:rgba(239,68,68,0.16);
      border-radius:10px;
      border:1px solid rgba(239,68,68,0.55);
      padding:8px 10px;
      font-size:12px;
      color:#fecaca;
      margin-top:6px;
    }
  </style>
</head>

<body>
<div class="app">
  <header>
    <div class="logo">
      <div class="logo-mark">C</div>
      <div>
        <div class="logo-text-main">Cepterandevu</div>
        <div class="logo-text-sub">İşletme Kontrol Paneli</div>
      </div>
    </div>
    <button id="logoutBtn" class="logout-btn">Çıkış Yap</button>
  </header>

  <main class="main-grid">
    <!-- SOL: İŞLETME ÖZET -->
    <section>
      <div class="card">
        <h2>İşletmem</h2>
        <p class="sub">Bilgilerini kontrol et, randevularını ve ekibini tek yerden yönet.</p>

        <div id="bizContent">
          Yükleniyor...
        </div>
      </div>
    </section>

    <!-- SAĞ: KISAYOL KARTLARI -->
    <section>
      <div class="card">
        <h2>Hızlı İşlemler</h2>
        <p class="sub">En sık yaptığın ayar ve işlemlere tek dokunuşla git.</p>

        <div class="nav-grid">
          <div class="nav-card" onclick="window.location.href='business-services.html'">
            <div class="nav-title">Hizmetler</div>
            <div class="nav-desc">
              Saç kesim, bakım, muayene, seans gibi tüm hizmetlerini ekle / düzenle.
            </div>
          </div>

          <div class="nav-card" onclick="window.location.href='business-employees.html'">
            <div class="nav-title">Çalışanlar</div>
            <div class="nav-desc">
              Personel ekle, hangi hizmeti kimin yapacağını belirle.
            </div>
          </div>

          <div class="nav-card" onclick="window.location.href='business-appointments.html'">
            <div class="nav-title">Randevular</div>
            <div class="nav-desc">
              Gelen randevuları onayla / reddet, yoğunluğu takip et.
            </div>
          </div>

          <div class="nav-card" onclick="window.location.href='business-settings.html'">
            <div class="nav-title">Ayarlar</div>
            <div class="nav-desc">
              Çalışma saatleri, kapalı günler, logo ve bildirim ayarlarını yönet.
            </div>
          </div>
        </div>

        <p class="hint">
          İpuçu: İlk önce <strong>Hizmetler</strong> ve <strong>Çalışanlar</strong> sayfalarını tamamla, sonra randevu almaya başla.
        </p>
      </div>
    </section>
  </main>
</div>

<script type="module">
  import { firebaseConfig } from "./js/firebase-config.js";

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore, collection, query, where, getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import {
    getAuth, onAuthStateChanged, signOut
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const bizContent = document.getElementById("bizContent");
  const logoutBtn = document.getElementById("logoutBtn");

  onAuthStateChanged(auth, async (user)=>{
    if(!user){
      window.location.href = "business-login.html";
      return;
    }

    await loadBusinessForOwner(user.uid);
  });

  async function loadBusinessForOwner(uid){
    try{
      const qBiz = query(
        collection(db,"businesses"),
        where("ownerUID","==", uid)
      );
      const snap = await getDocs(qBiz);

      if(snap.empty){
        bizContent.innerHTML = `
          <div class="error-box">
            Bu hesapla ilişkili bir işletme bulunamadı.<br>
            Henüz kayıt formunu tamamlamadıysan <strong>business-register.html</strong> üzerinden yeni işletme oluştur.
          </div>
        `;
        return;
      }

      const docSnap = snap.docs[0];
      const biz = docSnap.data();

      const name = biz.name || "İsimsiz İşletme";
      const city = biz.city || "-";
      const district = biz.district || "-";
      const tags = Array.isArray(biz.tags) ? biz.tags : [];

      const totalAppointments = biz.totalAppointments || 0;
      const activeEmployees = biz.activeEmployees || 0;

      bizContent.innerHTML = `
        <div class="biz-header">
          <div>
            <div class="biz-name">${name}</div>
            <div class="biz-location">${city} · ${district}</div>
          </div>
          <div class="pill">İşletme ID: ${docSnap.id}</div>
        </div>

        <div class="tag-row">
          ${
            tags.length
              ? tags.map(t=>`<span class="tag">${t}</span>`).join("")
              : '<span class="small-label">Tanımlı etiket yok. (Kuaför, Klinik, Spa vb.)</span>'
          }
        </div>

        <div class="biz-stats">
          <span>
            <strong>${totalAppointments}</strong>
            Toplam randevu
          </span>
          <span>
            <strong>${activeEmployees}</strong>
            Aktif çalışan
          </span>
        </div>
      `;
    }catch(err){
      console.error(err);
      bizContent.innerHTML = `
        <div class="error-box">
          İşletme bilgileri yüklenirken bir hata oluştu: ${err.message}
        </div>
      `;
    }
  }

  logoutBtn.addEventListener("click", async ()=>{
    await signOut(auth);
    window.location.href = "business-login.html";
  });
</script>

</body>
</html>
