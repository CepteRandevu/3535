<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>İşletme Detayı</title>

<style>
  body {
    margin: 0;
    background: #f5f7fa;
    font-family: Arial;
  }

  .cover {
    width: 100%;
    height: 220px;
    object-fit: cover;
  }

  .container {
    padding: 16px;
  }

  .name {
    font-size: 24px;
    font-weight: bold;
    margin-top: 10px;
  }

  .info {
    margin-top: 6px;
    color: #475569;
    font-size: 15px;
  }

  .rating {
    margin-top: 10px;
    font-size: 18px;
    color: #f59e0b;
    font-weight: bold;
  }

  h3 {
    margin-top: 25px;
    font-size: 20px;
    color: #0f172a;
  }

  .card {
    background: white;
    padding: 14px;
    border-radius: 12px;
    margin-bottom: 16px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  }

  .service, .worker {
    padding: 10px 0;
    border-bottom: 1px solid #e2e8f0;
  }

  .service:last-child, .worker:last-child {
    border-bottom: none;
  }

  .btn {
    width: 100%;
    padding: 14px;
    background: #007bff;
    border: none;
    color: white;
    border-radius: 12px;
    font-size: 18px;
    margin-top: 30px;
    cursor: pointer;
  }

</style>
</head>

<body>

<img id="cover" class="cover" src="">

<div class="container">
  <div class="name" id="name">İşletme Adı</div>
  <div class="info" id="info">Kategori • Şehir/İlçe</div>
  <div class="rating" id="rating">⭐ 0.0 (0 yorum)</div>

  <h3>Hakkında</h3>
  <div class="card" id="about">Yükleniyor...</div>

  <h3>Hizmetler</h3>
  <div class="card" id="services">Yükleniyor...</div>

  <h3>Çalışanlar</h3>
  <div class="card" id="workers">Yükleniyor...</div>

  <button class="btn" onclick="goBooking()">Randevu Al</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, doc, getDoc, collection, query, where, getDocs 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB8jn673zFuYRDhgzFd5yfZ-MP2XSXgyFg",
    authDomain: "cepterandevu-35fe4.firebaseapp.com",
    projectId: "cepterandevu-35fe4",
    storageBucket: "cepterandevu-35fe4.appspot.com",
    messagingSenderId: "86298180836",
    appId: "1:86298180836:web:ab05fbb0dcfbb56b2700f1"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const params = new URLSearchParams(window.location.search);
  const businessId = params.get("id");

  loadBusiness();
  loadServices();
  loadWorkers();

  async function loadBusiness() {
    const ref = doc(db, "businesses", businessId);
    const snap = await getDoc(ref);

    if (!snap.exists()) return;

    const b = snap.data();

    document.getElementById("cover").src =
      b.coverPhoto || "https://via.placeholder.com/800x400?text=Kapak+Fotoğrafı";

    document.getElementById("name").innerText = b.name;
    document.getElementById("info").innerText = `${b.category} • ${b.city}/${b.district}`;
    document.getElementById("rating").innerText =
      `⭐ ${b.rating || 0} (${b.reviewCount || 0} yorum)`;

    document.getElementById("about").innerText = b.description || "Henüz açıklama eklenmemiş.";
  }

  async function loadServices() {
    const q = query(collection(db, "services"), where("businessId", "==", businessId));
    const snap = await getDocs(q);

    const box = document.getElementById("services");
    box.innerHTML = "";

    if (snap.empty) {
      box.innerHTML = "<p>Bu işletmeye ait hizmet bulunmuyor.</p>";
      return;
    }

    snap.forEach(doc => {
      const s = doc.data();
      box.innerHTML += `
        <div class="service">
          <b>${s.name}</b> - ${s.price} TL
        </div>
      `;
    });
  }

  async function loadWorkers() {
    const q = query(collection(db, "workers"), where("businessId", "==", businessId));
    const snap = await getDocs(q);

    const box = document.getElementById("workers");
    box.innerHTML = "";

    if (snap.empty) {
      box.innerHTML = "<p>Çalışan bilgisi yok.</p>";
      return;
    }

    snap.forEach(doc => {
      const w = doc.data();
      box.innerHTML += `
        <div class="worker">
          <b>${w.name}</b><br>
          ${w.role || ""}
        </div>
      `;
    });
  }

  // Randevu sayfasına git
  window.goBooking = function() {
    window.location.href = `booking.html?id=${businessId}`;
  }
</script>

</body>
</html>
