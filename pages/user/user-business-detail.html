<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>İşletme Detayı</title>


<style>
  :root {
    --bg: #020617;
    --card: #020617;
    --card-soft: #0b1220;
    --accent: #2563eb;
    --accent-soft: rgba(37,99,235,0.22);
    --accent-strong: #1d4ed8;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --border: rgba(148,163,184,0.35);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #1e40af 0, #020617 40%, #000 100%);
    color: var(--text);
  }
  .cover {
    width: 100%;
    height: 170px;
    background: linear-gradient(135deg,#1d4ed8,#4f46e5);
  }
  .content {
    padding: 16px;
    margin-top: -40px;
  }
  .name {
    font-size: 20px;
    font-weight: 600;
  }
  .loc {
    font-size: 12px;
    color: var(--muted);
    margin-top: 3px;
  }
  .rating {
    margin-top: 6px;
    font-size: 14px;
    color: #facc15;
    font-weight: 600;
  }
  .card {
    background: rgba(15,23,42,0.96);
    border-radius: 16px;
    padding: 14px;
    margin-top: 14px;
    border: 1px solid rgba(30,64,175,0.7);
    box-shadow: 0 12px 30px rgba(15,23,42,0.9);
    font-size: 13px;
  }
  .card h3 {
    margin-top: 0;
    margin-bottom: 8px;
    font-size: 15px;
  }
  .btn-primary {
    margin-top: 12px;
    width: 100%;
    padding: 11px;
    border-radius: 999px;
    border: none;
    background: linear-gradient(135deg,#2563eb,#4f46e5);
    color: white;
    font-size: 14px;
    box-shadow: 0 14px 35px rgba(37,99,235,0.5);
  }
</style>

</head>

<body>

<img id="cover" class="cover" src="">

<div class="container">
  <div class="name" id="name">İşletme Adı</div>
  <div class="info" id="info">Kategori • Şehir/İlçe</div>
  <div class="rating" id="rating">⭐ 0.0 (0 yorum)</div>

  <h3>Hakkında</h3>
  <div class="card" id="about">Yükleniyor...</div>

  <h3>Hizmetler</h3>
  <div class="card" id="services">Yükleniyor...</div>

  <h3>Çalışanlar</h3>
  <div class="card" id="workers">Yükleniyor...</div>

  <button class="btn" onclick="goBooking()">Randevu Al</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, doc, getDoc, collection, query, where, getDocs 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB8jn673zFuYRDhgzFd5yfZ-MP2XSXgyFg",
    authDomain: "cepterandevu-35fe4.firebaseapp.com",
    projectId: "cepterandevu-35fe4",
    storageBucket: "cepterandevu-35fe4.appspot.com",
    messagingSenderId: "86298180836",
    appId: "1:86298180836:web:ab05fbb0dcfbb56b2700f1"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const params = new URLSearchParams(window.location.search);
  const businessId = params.get("id");

  loadBusiness();
  loadServices();
  loadWorkers();

  async function loadBusiness() {
    const ref = doc(db, "businesses", businessId);
    const snap = await getDoc(ref);

    if (!snap.exists()) return;

    const b = snap.data();

    document.getElementById("cover").src =
      b.coverPhoto || "https://via.placeholder.com/800x400?text=Kapak+Fotoğrafı";

    document.getElementById("name").innerText = b.name;
    document.getElementById("info").innerText = `${b.category} • ${b.city}/${b.district}`;
    document.getElementById("rating").innerText =
      `⭐ ${b.rating || 0} (${b.reviewCount || 0} yorum)`;

    document.getElementById("about").innerText = b.description || "Henüz açıklama eklenmemiş.";
  }

  async function loadServices() {
    const q = query(collection(db, "services"), where("businessId", "==", businessId));
    const snap = await getDocs(q);

    const box = document.getElementById("services");
    box.innerHTML = "";

    if (snap.empty) {
      box.innerHTML = "<p>Bu işletmeye ait hizmet bulunmuyor.</p>";
      return;
    }

    snap.forEach(doc => {
      const s = doc.data();
      box.innerHTML += `
        <div class="service">
          <b>${s.name}</b> - ${s.price} TL
        </div>
      `;
    });
  }

  async function loadWorkers() {
    const q = query(collection(db, "workers"), where("businessId", "==", businessId));
    const snap = await getDocs(q);

    const box = document.getElementById("workers");
    box.innerHTML = "";

    if (snap.empty) {
      box.innerHTML = "<p>Çalışan bilgisi yok.</p>";
      return;
    }

    snap.forEach(doc => {
      const w = doc.data();
      box.innerHTML += `
        <div class="worker">
          <b>${w.name}</b><br>
          ${w.role || ""}
        </div>
      `;
    });
  }

  // Randevu sayfasına git
  window.goBooking = function() {
    window.location.href = `booking.html?id=${businessId}`;
  }
</script>

</body>
</html>
