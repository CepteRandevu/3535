<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>İşletmeler</title>


<style>
  :root {
    --bg: #020617;
    --card: #020617;
    --card-soft: #0b1220;
    --accent: #2563eb;
    --accent-soft: rgba(37,99,235,0.22);
    --accent-strong: #1d4ed8;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --border: rgba(148,163,184,0.35);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #1e40af 0, #020617 40%, #000 100%);
    color: var(--text);
  }
  header {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(30,64,175,0.7);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h2 {
    margin: 0;
    font-size: 17px;
  }
  header span {
    font-size: 11px;
    color: var(--muted);
  }
  .back {
    font-size: 20px;
    text-decoration: none;
    color: var(--muted);
  }
  #list {
    padding: 14px 16px 30px;
  }
  .biz-card {
    background: rgba(15,23,42,0.96);
    border-radius: 16px;
    padding: 12px 12px 10px;
    margin-bottom: 10px;
    border: 1px solid rgba(30,64,175,0.7);
    box-shadow: 0 12px 30px rgba(15,23,42,0.9);
    cursor: pointer;
  }
  .title {
    font-size: 15px;
    font-weight: 600;
  }
  .info {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
  }
  .rating {
    margin-top: 6px;
    color: #facc15;
    font-size: 14px;
    font-weight: 600;
  }
</style>

</head>

<body>

<header>
  <h2>İşletmeler</h2>
</header>

<div class="list" id="list">Yükleniyor...</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, collection, getDocs 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB8jn673zFuYRDhgzFd5yfZ-MP2XSXgyFg",
    authDomain: "cepterandevu-35fe4.firebaseapp.com",
    projectId: "cepterandevu-35fe4",
    storageBucket: "cepterandevu-35fe4.appspot.com",
    messagingSenderId: "86298180836",
    appId: "1:86298180836:web:ab05fbb0dcfbb56b2700f1"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // --- URL PARAMETRELERİ ---
  const params = new URLSearchParams(window.location.search);
  const category = params.get("cat");
  const city = params.get("city");
  const district = params.get("district");

  // -----------------------------  
  // İŞLETMELERİ YÜKLE  
  // -----------------------------
  loadBusinesses();

  async function loadBusinesses() {
    const listBox = document.getElementById("list");

    const snap = await getDocs(collection(db, "businesses"));

    let html = "";

    snap.forEach(doc => {
      const b = doc.data();

      // Filtre (kategori + şehir + ilçe)
      if (b.category !== category) return;
      if (b.city !== city) return;
      if (b.district !== district) return;

      const img = b.coverPhoto || "https://via.placeholder.com/400x200?text=Kapak+Fotoğrafı";

      html += `
        <div class="business-card" onclick="goDetail('${doc.id}')">
          <img src="${img}">
          <div class="name">${b.name}</div>
          <div class="info">${b.category} • ${b.city}/${b.district}</div>
          <div class="rating">⭐ ${b.rating || "0.0"} (${b.reviewCount || 0} yorum)</div>
        </div>
      `;
    });

    if (!html) {
      html = "<p>Bu bölgede işletme bulunamadı.</p>";
    }

    listBox.innerHTML = html;
  }

  // --- DETAILS SAYFASINA GİT ---
  window.goDetail = function(id){
    window.location.href = `user-business-detail.html?id=${id}`;
  };
</script>

</body>
</html>
