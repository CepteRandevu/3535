<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İşletmeler</title>

<style>
  body { margin: 0; background:#f5f7fa; font-family:Arial; }
  .topbar {
    background:white; padding:16px; font-size:22px; font-weight:700;
    box-shadow:0 2px 14px rgba(0,0,0,0.05); position:sticky; top:0; z-index:10;
  }
  .card {
    background:white; margin:16px; border-radius:16px; overflow:hidden;
    box-shadow:0 4px 12px rgba(0,0,0,0.08); cursor:pointer;
  }
  .cover { width:100%; height:140px; object-fit:cover; background:#ddd; }
  .info { padding:14px; }
  .name { font-size:18px; font-weight:700; margin-top:6px; }
  .location { color:#64748b; font-size:14px; margin-top:4px; }
  .empty {
    margin:20px; background:white; padding:16px; border-radius:14px;
    text-align:center; color:#6b7280; box-shadow:0 2px 10px rgba(0,0,0,0.05);
  }
</style>
</head>

<body>

<div class="topbar">İşletmeler</div>
<div id="list"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB8jn673zFuYRDhgzFd5yfZ-MP2XSXgyFg",
    authDomain: "cepterandevu-35fe4.firebaseapp.com",
    projectId: "cepterandevu-35fe4",
    storageBucket: "cepterandevu-35fe4.appspot.com",
    messagingSenderId: "86298180836",
    appId: "1:86298180836:web:ab05fbb0dcfbb56b2700f1",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // URL parametrelerini al
  const params = new URLSearchParams(window.location.search);
  const city = params.get("city");
  const district = params.get("district");

  async function load() {
    const box = document.getElementById("list");

    if (!city || !district) {
      box.innerHTML = "<div class='empty'>İl ve ilçe seçilmemiş.</div>";
      return;
    }

    box.innerHTML = "<div class='empty'>Yükleniyor...</div>";

    const q = query(
      collection(db, "businesses"),
      where("city", "==", city),
      where("district", "==", district)
    );

    const snap = await getDocs(q);

    box.innerHTML = "";

    if (snap.empty) {
      box.innerHTML = "<div class='empty'>Bu bölgede işletme bulunamadı.</div>";
      return;
    }

    snap.forEach(doc => {
      const b = doc.data();
      const id = doc.id;

      box.innerHTML += `
        <div class="card" onclick="openDetail('${id}')">
          <div class="info">
            <div class="name">${b.name}</div>
            <div class="location">${b.city} / ${b.district}</div>
          </div>
        </div>
      `;
    });
  }

  window.openDetail = function(id) {
    window.location.href = `detail.html?id=${id}`;
  };

  load();
</script>

</body>
</html>
