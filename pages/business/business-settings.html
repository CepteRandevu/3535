<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>İşletme Ayarları</title>

<style>
  body {
    margin: 0;
    padding: 20px;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
  }
  h2 {
    margin-top: 0;
    color: #111827;
  }
  .field {
    margin-top: 12px;
  }
  label {
    display: block;
    font-size: 14px;
    margin-bottom: 4px;
    color: #374151;
  }
  input, textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    font-size: 14px;
    box-sizing: border-box;
  }
  textarea {
    resize: vertical;
    min-height: 60px;
  }
  button {
    margin-top: 18px;
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 10px;
    background: #007bff;
    color: white;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
  }
  button:active {
    opacity: .9;
  }
</style>
</head>

<body>

<h2>İşletme Ayarları</h2>

<div class="field">
  <label for="name">İşletme adı</label>
  <input id="name" type="text" placeholder="Örn: Randeo Kuaför">
</div>

<div class="field">
  <label for="phone">Telefon</label>
  <input id="phone" type="text" placeholder="Örn: 0555 555 55 55">
</div>

<div class="field">
  <label for="city">İl</label>
  <input id="city" type="text" placeholder="Örn: İzmir">
</div>

<div class="field">
  <label for="district">İlçe</label>
  <input id="district" type="text" placeholder="Örn: menderes">
</div>


<div class="field">
  <label for="startHour">Çalışma başlangıç saati</label>
  <input id="startHour" type="time">
</div>

<div class="field">
  <label for="endHour">Çalışma bitiş saati</label>
  <input id="endHour" type="time">
</div>

<div class="field">
  <label for="address">Adres</label>
  <textarea id="address" placeholder="Açık adres"></textarea>
</div>

<button id="saveBtn">Kaydet</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, doc, setDoc, getDoc 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { 
    getAuth, onAuthStateChanged 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB8jn673zFuYRDhgzFd5yfZ-MP2XSXgyFg",
    authDomain: "cepterandevu-35fe4.firebaseapp.com",
    projectId: "cepterandevu-35fe4",
    storageBucket: "cepterandevu-35fe4.appspot.com",
    messagingSenderId: "86298180836",
    appId: "1:86298180836:web:ab05fbb0dcfbb56b2700f1"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let USER_ID = null;

  // Kullanıcı oturumunu al
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      alert("Giriş gerekli");
      // aynı klasörde olduğu için sadece dosya adı
      window.location.href = "business-auth.html";
      return;
    }
    USER_ID = user.uid;

    // Mevcut verileri doldur
    const ref = doc(db, "businesses", USER_ID);
    const snap = await getDoc(ref);
    if (snap.exists()) {
      const b = snap.data();
      document.getElementById("name").value     = b.name     || "";
      document.getElementById("phone").value    = b.phone    || "";
      document.getElementById("city").value     = b.city     || "";
      document.getElementById("district").value = b.district || "";
      document.getElementById("address").value  = b.address  || "";
      document.getElementById("startHour").value = b.startHour || "";
      document.getElementById("endHour").value   = b.endHour   || "";
    }
  });

  // KAYDET
  document.getElementById("saveBtn").onclick = async function () {
    if (!USER_ID) return;

    const name     = document.getElementById("name").value.trim();
    const city     = document.getElementById("city").value.trim();
    const district = document.getElementById("district").value.trim().toLowerCase();
    const phone    = document.getElementById("phone").value.trim();
    const address  = document.getElementById("address").value.trim();
    const startHour = document.getElementById("startHour").value;
    const endHour   = document.getElementById("endHour").value;

    if (!name || !city || !district) {
      alert("İsim, il ve ilçe zorunludur.");
      return;
    }

    // setDoc + merge → doküman yoksa oluşturur, varsa günceller
    await setDoc(
      doc(db, "businesses", USER_ID),
      {
        name,
        city,
        district,
        phone,
        address,
        startHour: startHour || "09:00",
        endHour:   endHour   || "21:00",
        updatedAt: new Date()
      },
      { merge: true }
    );

    alert("Kaydedildi!");
  };
</script>

</body>
</html>
